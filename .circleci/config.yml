version: 2.1
jobs:
 build:
  docker:
   - image: hashicorp/terraform:latest
  steps:
   - checkout
   - run:
      name: checkout the code and run terraform plan
      command: |
        terraform init -input=false
        terraform plan -out tfapply -var-file terraform.tfvars
        terraform apply --auto-approve
        terraform destroy --auto-approve tfapply
workflows:
 deployment: 
  jobs:
   - build